<!-- templates/unassigned_transactions.html -->
{% extends 'layout.html' %}
{% block content %}
  <h2>Unassigned Transactions</h2>
  <a href="{{ url_for('stats') }}" class="btn btn-secondary mb-3">Back to Stats</a>

  {% if transactions %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Buchungsdatum</th>
        <th>Text</th>
        <th>Betrag</th>
        <th>Verwendungszweck</th>
        <th>Name des Partners</th>
      </tr>
    </thead>
    <tbody>
    {% for idx, trx in transactions %}
      {% set is_refund = false %}
      {% for lst in lists_data %}
        {% if lst['refund_list'] and (idx in lst['transaction_ids']) %}
          {% set is_refund = true %}
        {% endif %}
      {% endfor %}
      <tr {% if is_refund %}style="text-decoration: line-through;"{% endif %}>
        <td>{{ idx }}</td>
        <td>{{ trx['Buchungsdatum'] }}</td>
        <td>{{ trx['Buchungstext'] }} / {{ trx['Umsatztext'] }}</td>
        <td>{{ "%.2f"|format(trx['Betrag']) }} €</td>
        <td>{{ trx['Verwendungszweck'] }}</td>
        <td>{{ trx['Name des Partners'] }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <div class="mt-3">
    <p><strong>Total:</strong> {{ "%.2f"|format(total) }} €</p>
    <p><strong>Refundable:</strong> {{ "%.2f"|format(refundable) }} €</p>
    <p><strong>Total after refund:</strong> {{ "%.2f"|format(after_refund) }} €</p>
  </div>
  {% else %}
  <div class="alert alert-info">
    No transactions are unassigned.
  </div>
  {% endif %}
{% endblock %}
